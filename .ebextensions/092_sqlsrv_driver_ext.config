files:
    "/etc/php.d/30-sqlsrv.ini":
        mode: "000644"
        owner: root
        group: root
        content: |
            ; Microsoft SQL Server driver for PHP
            extension=sqlsrv.so
            extension=pdo_sqlsrv.so

            ; SQL Server driver settings
            sqlsrv.WarningsReturnAsErrors = 0
            sqlsrv.LogSeverity = 0
            sqlsrv.LogSubsystems = 0
            sqlsrv.ClientBufferMaxKBSize = 10240

container_commands:
    01_remove_old_ini_files:
        command: |
            sudo rm -f /etc/php.d/php-sqlsrv.ini
            sudo rm -f /etc/php.d/php-sqlsrv.ini.bak
            sudo rm -f /etc/php.d/sqlsrv.ini
        ignoreErrors: true

    02_restart_php_fpm:
        command: |
            if systemctl is-active --quiet php-fpm; then
                sudo systemctl restart php-fpm
            fi
        ignoreErrors: true

    03_verify_extensions:
        command: |
            echo "Verifying PHP extensions..."
            php -m | grep -i sqlsrv || echo "SQL Server extensions not loaded"
            echo "PHP version:"
            php -v
        ignoreErrors: true
