container_commands:
    01_ensure_php_modules_dir:
        command: "sudo mkdir -p /usr/lib64/php8.2/modules"
        ignoreErrors: true

    02_copy_sqlsrv_driver:
        command: |
            if [ -f /var/app/staging/drivers/php_sqlsrv_82_nts_x64.so ] && [ ! -f /usr/lib64/php8.2/modules/sqlsrv.so ]; then
                sudo cp /var/app/staging/drivers/php_sqlsrv_82_nts_x64.so /usr/lib64/php8.2/modules/sqlsrv.so
                sudo chmod 644 /usr/lib64/php8.2/modules/sqlsrv.so
                sudo chown root:root /usr/lib64/php8.2/modules/sqlsrv.so
                echo "Copied PHP 8.2 sqlsrv driver to /usr/lib64/php8.2/modules/"
            else
                echo "PHP 8.2 sqlsrv driver not found or already exists"
            fi

    03_copy_pdo_sqlsrv_driver:
        command: |
            if [ -f /var/app/staging/drivers/php_pdo_sqlsrv_82_nts_x64.so ] && [ ! -f /usr/lib64/php8.2/modules/pdo_sqlsrv.so ]; then
                sudo cp /var/app/staging/drivers/php_pdo_sqlsrv_82_nts_x64.so /usr/lib64/php8.2/modules/pdo_sqlsrv.so
                sudo chmod 644 /usr/lib64/php8.2/modules/pdo_sqlsrv.so
                sudo chown root:root /usr/lib64/php8.2/modules/pdo_sqlsrv.so
                echo "Copied PHP 8.2 pdo_sqlsrv driver to /usr/lib64/php8.2/modules/"
            else
                echo "PHP 8.2 pdo_sqlsrv driver not found or already exists"
            fi

    04_verify_drivers:
        command: |
            echo "Checking for SQL Server drivers in PHP 8.2 modules directory..."
            if [ -f /usr/lib64/php8.2/modules/sqlsrv.so ]; then
                echo "sqlsrv.so found in PHP 8.2 modules"
                ls -la /usr/lib64/php8.2/modules/sqlsrv.so
            else
                echo "Warning: sqlsrv.so not found in /usr/lib64/php8.2/modules/"
            fi
            if [ -f /usr/lib64/php8.2/modules/pdo_sqlsrv.so ]; then
                echo "pdo_sqlsrv.so found in PHP 8.2 modules"
                ls -la /usr/lib64/php8.2/modules/pdo_sqlsrv.so
            else
                echo "Warning: pdo_sqlsrv.so not found in /usr/lib64/php8.2/modules/"
            fi
            echo "PHP extension directory:"
            php -r "echo ini_get('extension_dir');" 2>/dev/null || echo "Could not determine PHP extension directory"
        ignoreErrors: true
