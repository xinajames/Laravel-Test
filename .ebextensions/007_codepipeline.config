container_commands:
  01_wait_for_ready:
    command: "sleep 10"
  02_set_permissions_first:
    command: |
      mkdir -p /var/app/staging/storage/logs
      chown -R webapp:webapp /var/app/staging/storage /var/app/staging/bootstrap/cache
      chmod -R 775 /var/app/staging/storage /var/app/staging/bootstrap/cache
    cwd: "/var/app/staging"
  03_artisan_migrate:
    command: |
      php artisan tinker --execute="DB::connection()->getPdo(); echo 'DB Connected';" || {
        echo "Database connection failed, skipping migrations"
        exit 0
      }
      php artisan migrate --force
    cwd: "/var/app/staging"
    leader_only: true
    ignoreErrors: true
  04_artisan_optimize:
    command: |
      php artisan config:cache
      php artisan route:cache  
      php artisan view:cache
    cwd: "/var/app/staging"
    ignoreErrors: true
